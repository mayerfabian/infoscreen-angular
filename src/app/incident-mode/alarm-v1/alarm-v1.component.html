<div class="screen-grid">
  <div class="col-left">
    <!-- OBERES PANEL: Einsatzinfo -->
    <section class="panel panel-info">
      <div class="panel-header">
        <h2>Einsatzinfo</h2>
        <div class="header-right" *ngIf="einsatz as e">
          <span class="elapsed-pill">+ {{ elapsedShort(e) }}</span>
        </div>
      </div>

      <div class="panel-body info-body" *ngIf="einsatz as e">
        <ng-container *ngIf="e.location as loc">
          <div class="address">
            {{ loc.street }} <span *ngIf="loc.housenumber">{{ loc.housenumber }}</span><br />
            {{ loc.zipcode }} {{ loc.city }}
          </div>
        </ng-container>

        <div class="note" *ngIf="e.additionalinformation as info">
          {{ info }}
        </div>

        <!-- Alarmierte Feuerwehren (Badges) -->
        <div class="stations" *ngIf="stations?.length">
          <span class="station-badge" *ngFor="let s of stations">{{ s }}</span>
        </div>

        <div class="alarm-datetime">
          <span class="date">{{ e.alarmtime | date:'EEEE, dd.MM.yyyy' }}</span>
          <span class="time">{{ e.alarmtime | date:'HH:mm:ss' }}</span>
        </div>
      </div>
    </section>

    <!-- UNTERES PANEL: Rückmeldungen & Fähigkeiten -->
    <section class="panel panel-responses">
      <div class="panel-header">
        <h2>Rückmeldungen & Fähigkeiten</h2>
      </div>

      <div class="panel-body responses-body" [class.dense]="dense">
        <!-- A) Rückmeldungen (oben) -->
        <div class="responses-top">
          <div class="people-list">
            <!-- ZUSAGEN -->
            <div class="person yes" *ngFor="let p of peopleYes">
              <span class="flag yes" aria-hidden="true"></span>
              <div class="text">
                <div class="line">
                  <div class="name">{{ p.name }}</div>
                  <!-- Rollen-Badges pro User nur wenn unten ausgeblendet -->
                  <ng-container *ngIf="showBadgesPerUser">
                    <span class="rbadge el"    *ngIf="p.roles.includes('EL')">EL</span>
                    <span class="rbadge elmit" *ngIf="p.roles.includes('ELMIT')">EL</span>
                    <span class="rbadge ats"   *ngIf="p.roles.includes('ATS')">ATS</span>
                    <span class="rbadge c"     *ngIf="p.roles.includes('C')">C</span>
                  </ng-container>
                </div>
              </div>
            </div>

            <!-- ABSAGEN -->
            <div class="person no" *ngFor="let p of peopleNo">
              <span class="flag no" aria-hidden="true"></span>
              <div class="text">
                <div class="line">
                  <div class="name">{{ p.name }}</div>
                  <ng-container *ngIf="showBadgesPerUser">
                    <span class="rbadge el"    *ngIf="p.roles.includes('EL')">EL</span>
                    <span class="rbadge elmit" *ngIf="p.roles.includes('ELMIT')">EL</span>
                    <span class="rbadge ats"   *ngIf="p.roles.includes('ATS')">ATS</span>
                    <span class="rbadge c"     *ngIf="p.roles.includes('C')">C</span>
                  </ng-container>
                </div>
                <div class="reason" *ngIf="p.freeText">{{ p.freeText }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- B) Funktions-Karten (unten) -->
        <div class="roles-bottom">
          <div class="role-grid">
            <div class="role-card el">
              <div class="head">
                <div class="title">EL</div>
                <div class="count">{{ roleBoxes[0].yesCount }}</div>
              </div>
              <div class="names" *ngIf="roleBoxes[0].showNames && roleBoxes[0].yesNames?.length">
                <div class="n" *ngFor="let n of roleBoxes[0].yesNames">{{ n }}</div>
              </div>
            </div>

            <div class="role-card elmit">
              <div class="head">
                <div class="title">EINSATZLEITUNG</div>
                <div class="count">{{ roleBoxes[1].yesCount }}</div>
              </div>
              <div class="names" *ngIf="roleBoxes[1].showNames && roleBoxes[1].yesNames?.length">
                <div class="n" *ngFor="let n of roleBoxes[1].yesNames">{{ n }}</div>
              </div>
            </div>

            <div class="role-card ats">
              <div class="head">
                <div class="title">ATS</div>
                <div class="count">{{ roleBoxes[2].yesCount }}</div>
              </div>
              <div class="names" *ngIf="roleBoxes[2].showNames && roleBoxes[2].yesNames?.length">
                <div class="n" *ngFor="let n of roleBoxes[2].yesNames">{{ n }}</div>
              </div>
            </div>

            <div class="role-card cdriver">
              <div class="head">
                <div class="title">C-FAHRER</div>
                <div class="count">{{ roleBoxes[3].yesCount }}</div>
              </div>
              <div class="names" *ngIf="roleBoxes[3].showNames && roleBoxes[3].yesNames?.length">
                <div class="n" *ngFor="let n of roleBoxes[3].yesNames">{{ n }}</div>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- panel-body -->
    </section>
  </div>

  <!-- RECHTE SPALTE: Karte -->
  <section class="panel col-right">
    <div class="panel-header"><h2>Einsatzkarte</h2></div>
    <div class="panel-body map-body">
      <div id="incidentMapV1" class="map-container"></div>
    </div>
  </section>
</div>
